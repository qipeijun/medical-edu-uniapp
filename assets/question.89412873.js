import{C as e,j as t}from"./index-4a91be04.js";import{g as n,a as s,m as i}from"./questions.c06fdb8d.js";import{b as o}from"./constants.90a8addf.js";import{s as r,g as a}from"./storage.b6dfcd1b.js";import{c as u,b as c}from"./spaced-repetition.7378a4c3.js";const l=[{id:1,name:"系统解剖学",nameEn:"Systemic Anatomy",icon:"bone",color:"#03A9F4",description:"研究正常人体各器官系统的形态结构",categories:[{id:"c1_1",name:"骨学总论",questionCount:120,completedCount:45,thumbnail:""},{id:"c1_2",name:"关节学",questionCount:85,completedCount:20,thumbnail:""},{id:"c1_3",name:"消化系统",questionCount:200,completedCount:100,thumbnail:""},{id:"c1_4",name:"呼吸系统",questionCount:150,completedCount:80,thumbnail:""}]},{id:2,name:"生理学",nameEn:"Physiology",icon:"activity",color:"#F44336",description:"研究生物体及其组成部分的正常功能",categories:[{id:"c2_1",name:"细胞生理",questionCount:95,completedCount:30,thumbnail:""},{id:"c2_2",name:"血液循环",questionCount:180,completedCount:60,thumbnail:""}]},{id:3,name:"病理学",nameEn:"Pathology",icon:"microscope",color:"#E91E63",description:"研究疾病的发生发展规律及机制",categories:[{id:"c3_1",name:"病理学总论",questionCount:150,completedCount:40,thumbnail:""}]},{id:4,name:"药理学",nameEn:"Pharmacology",icon:"flask",color:"#FFC107",description:"研究药物与机体相互作用规律",categories:[]},{id:5,name:"内科学",nameEn:"Internal Medicine",icon:"stethoscope",color:"#4CAF50",description:"研究内脏器官疾病的诊断治疗",categories:[]},{id:6,name:"外科学",nameEn:"Surgery",icon:"scalpel",color:"#2196F3",description:"研究手术治疗疾病的临床学科",categories:[]},{id:7,name:"妇产科学",nameEn:"Obstetrics & Gynecology",icon:"female",color:"#FF4081",description:"研究女性生殖系统疾病及妊娠分娩",categories:[]},{id:8,name:"儿科学",nameEn:"Pediatrics",icon:"baby",color:"#00BCD4",description:"研究儿童生长发育及疾病防治",categories:[]}],h=e("question",{state:()=>({subjects:l,currentSubject:null,currentCategory:null,questions:[],currentQuestion:null,currentQuestionIndex:0,userAnswers:{},mode:"practice",answerStartTime:null}),getters:{totalQuestions:e=>e.questions.length,answeredCount:e=>{if(!e.questions.length)return 0;return e.questions.map(e=>e.id).filter(t=>e.userAnswers[t]).length},progress:e=>0===e.totalQuestions?0:Math.round(e.answeredCount/e.totalQuestions*100),accuracy:e=>{const t=Object.values(e.userAnswers);if(0===t.length)return 0;const n=t.filter(e=>e.isCorrect).length;return Math.round(n/t.length*100)},hasNext:e=>e.currentQuestionIndex<e.questions.length-1,hasPrevious:e=>e.currentQuestionIndex>0},actions:{setCurrentCategory(e,t=null){this.currentSubject=this.subjects.find(t=>t.id===e),this.currentCategory=t,this.loadQuestions(e,t)},loadQuestions(e,t=null){this.questions=n(e,t),this.currentQuestionIndex=0,this.questions.length>0&&(this.currentQuestion=this.questions[0],this.startAnswerTimer())},loadQuestion(e){const t=s(e);t&&(this.currentQuestion=t,this.questions=[t],this.currentQuestionIndex=0,this.startAnswerTimer())},nextQuestion(){this.hasNext&&(this.currentQuestionIndex++,this.currentQuestion=this.questions[this.currentQuestionIndex],this.startAnswerTimer())},previousQuestion(){this.hasPrevious&&(this.currentQuestionIndex--,this.currentQuestion=this.questions[this.currentQuestionIndex],this.startAnswerTimer())},goToQuestion(e){e>=0&&e<this.questions.length&&(this.currentQuestionIndex=e,this.currentQuestion=this.questions[e],this.startAnswerTimer())},startAnswerTimer(){this.answerStartTime=Date.now()},submitAnswer(e,t){const n=this.currentQuestion||s(e);if(!n)return;const i=this.answerStartTime?Math.round((Date.now()-this.answerStartTime)/1e3):0;let o=!1;if("TYPE_A"===n.type)o=t===n.correctAnswer;else if("TYPE_X"===n.type){const e=new Set(n.correctAnswer),s=new Set(Array.isArray(t)?t:[t]);o=e.size===s.size&&[...e].every(e=>s.has(e))}this.userAnswers[e]={answer:t,isCorrect:o,timeSpent:i,answeredAt:(new Date).toISOString()},o?n.correctCount=(n.correctCount||0)+1:n.wrongCount=(n.wrongCount||0)+1;const r=u(o,i,n.hasViewedExplanation);if(n.reviewSchedule){const{nextReviewDate:t,newInterval:s,newEaseFactor:i,newReviewCount:o}=c({questionId:e,lastReview:new Date,reviewCount:n.reviewSchedule.reviewCount||0,easeFactor:n.reviewSchedule.easeFactor||2.5,interval:n.reviewSchedule.interval||1},r);n.reviewSchedule={nextReviewDate:t,interval:s,easeFactor:i,reviewCount:o}}else{const{nextReviewDate:t,newInterval:s,newEaseFactor:i}=c({questionId:e,lastReview:new Date,reviewCount:0,easeFactor:2.5,interval:1},r);n.reviewSchedule={nextReviewDate:t,interval:s,easeFactor:i,reviewCount:1}}return this.saveToStorage(),{isCorrect:o,correctAnswer:n.correctAnswer,explanation:n.explanation}},viewExplanation(e){const t=this.currentQuestion||s(e);t&&(t.hasViewedExplanation=!0)},toggleFavorite(e){t({title:"收藏功能开发中",icon:"none"})},saveToStorage(){r(o.ANSWER_HISTORY,this.userAnswers);const e={};i.forEach(t=>{t.reviewSchedule&&(e[t.id]=t.reviewSchedule)}),r(o.REVIEW_SCHEDULE,e)},loadFromStorage(){const e=a(o.ANSWER_HISTORY,{});this.userAnswers=e;const t=a(o.REVIEW_SCHEDULE,{});Object.keys(t).forEach(e=>{const n=i.find(t=>t.id===e);n&&(n.reviewSchedule=t[e])})},init(){this.loadFromStorage()}}});export{h as u};
