import{C as s,M as e,D as o,n as t}from"./index-4a91be04.js";import{b as r}from"./constants.90a8addf.js";import{r as a,s as n,g as i}from"./storage.b6dfcd1b.js";const u=s("user",{state:()=>({isLoggedIn:!1,isGuest:!1,token:"",userInfo:{id:"",phone:"",avatar:"",nickname:"",realName:"",school:"",major:"",grade:"",studentId:""}}),getters:{isInfoComplete:s=>Boolean(s.userInfo.school&&s.userInfo.major&&s.userInfo.grade&&s.userInfo.studentId),displayName:s=>s.userInfo.nickname||s.userInfo.realName||"同学",shortSchoolName:s=>s.userInfo.school?s.userInfo.school.replace(/(医学院|医学部|中山医学院|同济医学院|湘雅医学院|华西医学中心|齐鲁医学院)$/,""):""},actions:{async login(s){try{return this.token="mock_token_"+Date.now(),this.isLoggedIn=!0,this.isGuest=!1,this.userInfo={id:"user_001",phone:s.phone,avatar:"",nickname:"",realName:"",school:"",major:"",grade:"",studentId:""},this.saveToStorage(),{success:!0}}catch(e){return console.error("登录失败:",e),{success:!1,message:e.message}}},enterGuestMode(){this.isGuest=!0,this.isLoggedIn=!1,this.saveToStorage()},logout(){this.isLoggedIn=!1,this.isGuest=!1,this.token="",this.userInfo={id:"",phone:"",avatar:"",nickname:"",realName:"",school:"",major:"",grade:"",studentId:""},a(r.USER_TOKEN),a(r.USER_INFO),e({url:"/pages/mode-selection/index"})},async updateProfile(s){try{return this.userInfo={...this.userInfo,...s},this.saveToStorage(),{success:!0}}catch(e){return console.error("更新用户信息失败:",e),{success:!1,message:e.message}}},checkGuestAccess(s){return!this.isGuest||(o({title:"提示",content:"游客模式仅可浏览科普内容,请注册登录后使用完整功能",confirmText:"去登录",success:s=>{s.confirm&&t({url:"/pages/auth/login"})}}),!1)},saveToStorage(){n(r.USER_TOKEN,this.token),n(r.USER_INFO,this.userInfo)},loadFromStorage(){const s=i(r.USER_TOKEN),e=i(r.USER_INFO);s&&(this.token=s,this.isLoggedIn=!0),e&&(this.userInfo=e)},init(){this.loadFromStorage()}}});export{u};
